tosca_definitions_version: tosca_simple_yaml_1_0

description: Definition of the custom types of Micro TOSCA model


group_types:
  # Squad definition
  micro.groups.Squad:
    derived_from: tosca.groups.Root
    members: [micro.nodes.Root]
  # Nodes accessed by external client
  micro.groups.Edge:
    derived_from: tosca.groups.Root
    members: [micro.nodes.Root]
  
# relationship definitions
relationship_types:
  micro.relationships.Root:
    derived_from: tosca.relationships.Root
  
  micro.relationships.InteractsWith:
    derived_from: micro.relationships.Root
    valid_target_types: [ micro.nodes.Root ]

  # micro.relationships.RunTimeInteraction:
  #   derived_from: micro.relationships.Root
  #   valid_target_types: [ micro.nodes.Root ]
  #
  # micro.relationships.DeploymentTimeInteraction:
  #   derived_from: micro.relationships.Root
  #   valid_target_types: [ micro.nodes.Root ]

  # micro.relationships.ICRunTimeInteraction:
  #   derived_from: micro.relationships.RunTimeInteraction
  #   valid_target_types: [ micro.nodes.Service, micro.nodes.CommunicationPattern]
  #
  # micro.relationships.ICDeploymentTimeInteraction:
  #   derived_from: micro.relationships.DeploymentTimeInteraction
  #   valid_target_types: [ micro.nodes.Service, micro.nodes.CommunicationPattern]

# nodes definitions
node_types:
  # Root node
  micro.nodes.Root:
    derived_from: tosca.nodes.Root
    capabilities:
      feature:
        type: tosca.capabilities.Node
        valid_source_types: [micro.nodes.Root]
        occurrences: [0, UNBOUNDED]
 
  # Software node
  micro.nodes.Software:
    derived_from: micro.nodes.Root
  #  capabilities:
  #     feature:
  #       type: tosca.capabilities.Node
  #       valid_source_types: [micro.nodes.Software]
  #       occurrences: [0, UNBOUNDED]
    requirements:
      - run_time: # run_time_dependency | when_running
          capability: tosca.capabilities.Node
          occurrences: [0, UNBOUNDED]
          node: micro.nodes.Root
          relationship: micro.relationships.InteractsWith
      - deployment_time: # init_time_dependency | when_deploying
          capability: tosca.capabilities.Node
          occurrences: [0, UNBOUNDED]
          node: micro.nodes.Root
          relationship: micro.relationships.InteractsWith

  # Service node
  micro.nodes.Service:
    derived_from: micro.nodes.Software
    requirements:
      - run_time: # run_time_dependency | when_running
          capability: tosca.capabilities.Node
          occurrences: [0, UNBOUNDED]
          node: micro.nodes.Root
          relationship: micro.relationships.InteractsWith
      - deployment_time: # init_time_dependency | when_deploying
          capability: tosca.capabilities.Node
          occurrences: [0, UNBOUNDED]
          node: micro.nodes.Root
          relationship: micro.relationships.InteractsWith

  # CommunicationPattern node
  micro.nodes.CommunicationPattern: 
    derived_from: micro.nodes.Software
    requirements:
      - run_time:
          capability: tosca.capabilities.Node
          occurrences: [0, UNBOUNDED]
          node: micro.nodes.Software
          relationship: micro.relationships.InteractsWith
      - deployment_time:
          capability: tosca.capabilities.Node
          occurrences: [0, UNBOUNDED]
          node: micro.nodes.Software
          relationship: micro.relationships.InteractsWith

  # Database node
  micro.nodes.Database:
    derived_from: micro.nodes.Root
    capabilities:
      feature:
        type: tosca.capabilities.Node
        valid_source_types: [micro.nodes.Service]
        occurrences: [0, UNBOUNDED]

  #  Type of CommunicationPatterns
  micro.nodes.CircuitBreaker:
    derived_from: micro.nodes.CommunicationPattern

  micro.nodes.ApiGateway:
    derived_from: micro.nodes.CommunicationPattern

  micro.nodes.MessageBroker:
    derived_from: micro.nodes.CommunicationPattern

  micro.nodes.MessageRouter:
    derived_from: micro.nodes.CommunicationPattern
